# Перевод данных с API в Базу Данных

Глобально задачей было написать скрипт на Python, который:
* Будет обращаться к API платформы IT RESUME для получения данных
* Данные будут обрабатываться и готовиться к загрузке в базу данных университета, сотрудничающего с IT Resume.
* Обработанные данные будут загружаться в локальную базу PostgreSQL, которая была развернута на компьютере
* Во время обработки будет сохраняться лог работы скрипта с отлавливанием всех ошибок и выводом промежуточных стадий (например, скачивание началось / скачивание завершилось / заполнение базы началось и т.д., с трекингом времени). Лог сохраняется в текстовый файл. Файл именуется в соответствии с текущей датой. Если в папке с логами уже есть другие логи - они удаляются, остаются только логи за последние 3 дня.

Данные брал с API платформы IT Resume: "https://b2b.itresume.ru/api/statistics" с помощью библиотеки requests. Достаются они в формате json, поэтому после загрузки конвертирую их в словарь с помощью функции json.  

Для логирования использовал библиотеку logging, позволяющую легко настроить скрипт записи логов. Пример записи можно посмотреть в [этом файле](./2024-10-08.txt)

Для соединения с БД создал класс-коннектор DatabaseConnection в шаблоне SingleTon, обеспечивающий единственное уникальное подключение. Для соединения использовал библиотеку psycopg2.  

Все процессы по логированию, подключению к API и БД, парсера данных оформил в класс DataCarrier через множество методов. Для удобства дописал метод process, который последовательно вызывает все необходимые методы, прерываясь, если что-то пошло не так.

# Агрегация данных в Google Sheets
Вторая часть программы посвящена автоматической записи агрегированных данных из БД в Google Sheets. Я написал класс GoogleSheetsAPI, позволяющий подключиться к листу Google Sheets через их API с помощью полученных credentials и затем загрузить данные, полученные несколькими запросами к БД:
* текущая дата
* сколько попыток было совершено
* сколько успешных попыток было из всех совершенных
* количество уникальных юзеров

# Автоматическая отправка почтовых сообщений
С помощью библиотек ssl, smtplib и EmailMessage я настроил автоматическую отправку сообщений на указанную почту, к которой указан специальный сгенерированный пароль.  

Весь код можно посмотреть в [этом файле](./Parser_API_to_Own_DB.ipynb)
