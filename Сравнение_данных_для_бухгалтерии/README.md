# Постановка задачи

Аптечная компания «переезжает» с упрощенной системы налогообложения на общую. На яндекс диске есть csv файлы реализации по аптекам и выгрузки из СБИСа (Система бухгалтерского учёта). Нужно единоразово загрузить файл в 1С, но для этого надо сделать сравнение реализации и выгрузки из СБИСа. Для этого в каждом csv файле аптечной реализации будет добавлено несколько столбцов из выгрузки с СБИСа для сравнения, и в последнем добавленном стоблце будет показано, совпадает ли информация или нет. Сохранять эти файлы буду в созданной с помощью команды папке.

## Описание шагов:
Выгрузка из СБИС находится на диске в папке [Входящие](https://disk.yandex.ru/d/xKJ4KlXJIJEULw). В ней нужно взять только csv файлы, поэтому с помощью библиотеки request я сначала получаю информацию по папке, модулем json конвертирую в словарь, и оттуда получаю имена файлов. Отбираю только те, которые оканчиваются на .csv . Далее циклом пробегаюсь по каждому файлу, получаю ссылку на доступ к нему, подключаюсь и сохраняю его в dataframe pandas. И все эти датафреймы объединяю в единый Cbis_df датафрейм с помощью метода concat.

Файлы с выгрузкой из аптек находятся на диске в папке [Аптеки/csv/correct/](https://disk.yandex.ru/d/m9MtFWt56fDW7g/csv/correct). Для подключения к файлам проделываю те же действия, что и с выгрузкой из СБИСа, тоже сохраняю файлы в датафреймы, но не объединяю их в один, а обрабатываю их по отдельности. В каждый датафрейм добавляю столбцы "Номер счет-фактуры", "Сумма счет-фактуры", "Дата счет-фактуры", "Сравнение дат". Далее по следующим правилам заполняю их:
1. Если "Поставщик" - ЕАПТЕКА, то к "Номер накладной" нужно добавить /15.
2. Нужно найти все записи в выгрузке из СБИСа по данному номеру накладной
3. Из найденных строк нужно оставить только те, которые имеют один из типов документа: ["СчФктр", "УпдДоп", "УпдСчфДоп", "ЭДОНакл"]
4. Если ничего не найдено - просто переходим к следующей строке
5. Если найдено - нужно сохранить значения Номер, Сумма и Дата
6. Дату нужно представить в формате 25.05.2021
7. В столбцы из пункта 6 нужно записать найденные для данной строки значения
8. В столбец Сравнение дат помещаем "Не совпадает!", если найденная дата и дата накладной отличаются. Иначе - пустая строка. 

Далее отбираю только нужные столбцы и сохраняю их по пути "Результат/{полная сегодняшняя дата}/{имя исходного файла без расширения} - результат.xlsx". При отсутствии такой папки она автоматически создаётся с помощью модуля os.

Пример полученных файлов можно посмотреть в [этой папке](./Результат/2024-11-05)

Весь код можно посмотреть в [этом файле](./Work_with_Ydisk.ipynb)
